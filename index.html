<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DATA-BIT // TURKCE v6.6</title>
  <style>
    :root { 
      --c-bg: #020406;
      --c-card: rgba(10, 20, 30, 0.85);
      --c-border: rgba(64, 224, 208, 0.3);
      --c-prim: #0ff;
      --c-sec: #bc13fe;
      --c-warn: #fc0;
      --c-danger: #f05;
      --c-success: #0f8;
      font-family: 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }
    
    * { box-sizing: border-box; user-select: none; }

    body {
      margin: 0; background-color: var(--c-bg); color: #dbeeff;
      overflow: hidden; height: 100vh;
      display: flex; align-items: center; justify-content: center;
      perspective: 1000px;
    }

    /* --- MATRIX CANVAS --- */
    #matrixCanvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; opacity: 0.15; pointer-events: none; }
    
    .scanlines {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 4px, 6px 100%;
      pointer-events: none; z-index: 999; opacity: 0.6;
    }

    .scene { width: 100%; max-width: 1100px; transition: transform 0.1s ease-out; transform-style: preserve-3d; }

    .wrap {
      display: flex; gap: 20px; background: var(--c-card); border: 1px solid var(--c-border);
      padding: 24px; border-radius: 12px; box-shadow: 0 0 40px rgba(0, 255, 255, 0.15);
      backdrop-filter: blur(12px); position: relative;
    }

    .col-main { flex: 2; display: flex; flex-direction: column; gap: 20px; }
    .col-side { flex: 1; display: flex; flex-direction: column; gap: 20px; }

    h1 { margin: 0; font-size: 28px; color: var(--c-prim); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px rgba(0,255,255,0.6); }

    /* --- PANELS & GRID --- */
    .panel { border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; }
    
    .panel-head { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.5); display: flex; justify-content: space-between; }

    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .cell {
      aspect-ratio: 1; background: rgba(0, 255, 255, 0.03); border: 1px solid rgba(0, 255, 255, 0.15);
      border-radius: 8px; cursor: pointer; position: relative; transition: all 0.2s;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .cell:hover { background: rgba(0, 255, 255, 0.1); border-color: var(--c-prim); transform: scale(1.05); z-index: 10; box-shadow: 0 0 20px rgba(0,255,255,0.2); }
    .cell.active { border-color: var(--c-prim); box-shadow: 0 0 0 2px var(--c-prim), 0 0 25px rgba(0, 255, 255, 0.3); background: rgba(0, 255, 255, 0.1); }
    
    /* SPECIAL CELLS */
    .cell.wall { 
      background: repeating-linear-gradient(45deg, rgba(255,255,255,0.03), rgba(255,255,255,0.03) 10px, transparent 10px, transparent 20px);
      border-color: rgba(255,255,255,0.1); opacity: 0.6; cursor: not-allowed;
    }
    .cell.mine { border-color: var(--c-danger); background: rgba(255, 0, 85, 0.15); animation: glitch 0.2s infinite; }
    .cell.target { border-color: var(--c-warn); animation: pulse 1.5s infinite; }
    
    .cell .addr { position: absolute; top: 4px; left: 6px; font-size: 9px; opacity: 0.5; font-family: monospace; }
    .cell .icon { font-size: 32px; z-index: 2; filter: drop-shadow(0 0 8px rgba(0,0,0,0.5)); }

    @keyframes pulse { 50% { box-shadow: inset 0 0 30px rgba(255, 204, 0, 0.3); border-color: #fff; } }
    @keyframes glitch { 0% { transform: translate(1px); } 50% { transform: translate(-1px); } }

    /* --- UI ELEMENTS --- */
    .stat-row { display: flex; gap: 10px; align-items: center; font-family: monospace; font-size: 12px; }
    .bar-bg { flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
    .bar-fill { height: 100%; width: 100%; transition: width 0.3s; }

    .action-row { display: flex; gap: 10px; margin-top: auto; }
    .btn-act {
      flex: 1; padding: 15px; background: rgba(0, 255, 255, 0.05); border: 1px solid var(--c-prim);
      color: var(--c-prim); font-weight: bold; cursor: pointer; text-transform: uppercase;
      letter-spacing: 1px; border-radius: 6px; transition: 0.2s;
    }
    .btn-act:hover:not(:disabled) { background: rgba(0, 255, 255, 0.2); border-color: #fff; box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); }
    .btn-act:disabled { opacity: 0.3; filter: grayscale(1); }

    .obj-box { 
      background: linear-gradient(90deg, rgba(255, 204, 0, 0.1), transparent); 
      border-left: 3px solid var(--c-warn);
      padding: 12px; margin-bottom: 10px; color: var(--c-warn); 
      font-size: 13px; font-weight: bold; letter-spacing: 0.5px;
    }

    /* --- SHOP --- */
    .shop-btn {
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      padding: 12px; border-radius: 6px; cursor: pointer; transition: 0.2s;
      color: #ddd; font-family: monospace; font-size: 12px;
    }
    .shop-btn:hover:not(:disabled) { border-color: var(--c-prim); background: rgba(0,255,255,0.1); transform: translateX(5px); }
    .shop-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .shop-flash { animation: flashGreen 0.3s; }
    @keyframes flashGreen { 0% { background: var(--c-success); color: #000; } }

    /* --- MODAL --- */
    #modalOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 1000;
      display: flex; justify-content: center; align-items: center;
    }
    .modal-box {
      width: 500px; border: 1px solid var(--c-prim); background: var(--c-bg);
      padding: 40px; border-radius: 16px; text-align: center; box-shadow: 0 0 60px rgba(0,255,255,0.15);
    }
    .modal-btn {
      margin-top: 25px; padding: 12px 30px; background: var(--c-prim); border: none;
      color: #000; font-weight: bold; cursor: pointer; letter-spacing: 2px; border-radius: 4px;
      transition: 0.2s;
    }
    .modal-btn:hover { background: #fff; box-shadow: 0 0 20px #fff; }

  </style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>
<div class="scanlines"></div>

<div id="endTerminal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:2000; padding:40px; box-sizing:border-box; overflow-y:auto; font-family:'Courier New', monospace; color:#0f0; font-size:20px; line-height:1.4; text-shadow: 0 0 10px #0f0;">
  <div id="endText"></div>
  <span id="cursor" style="display:inline-block; width:12px; height:24px; background:#0f0; animation:blink 1s infinite; vertical-align:text-bottom;"></span>
</div>
<style>@keyframes blink { 50% { opacity: 0; } }</style>

<div id="modalOverlay">
  <div class="modal-box">
    <div id="mTitle" style="font-size: 28px; color: var(--c-prim); margin-bottom: 15px; font-weight: bold; text-shadow:0 0 10px var(--c-prim);">SÄ°STEM BAÄLANTISI</div>
    <div id="mText" style="font-size: 14px; line-height: 1.6; margin-bottom: 25px; color:#aaa;">NÃ¶ral El SÄ±kÄ±ÅŸma BaÅŸlatÄ±lÄ±yor...</div>
    <button class="modal-btn" id="mBtn">BAÄLANTIYI KUR</button>
  </div>
</div>

<div class="scene" id="scene">
  <div class="wrap">
    
    <div class="col-main">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>DATA-BIT <span id="lvlBadge" style="font-size: 12px; background: var(--c-sec); color: #fff; padding: 4px 10px; border-radius: 4px; margin-left: 10px; vertical-align: middle; box-shadow: 0 0 10px var(--c-sec);">SEKTÃ–R 1</span></h1>
        <button id="btnMusic" style="background:transparent; border:1px solid var(--c-prim); color:var(--c-prim); cursor:pointer; font-family:monospace; padding:5px 10px; border-radius:4px;">ğŸ”‡ SES: OFF</button>
      </div>
      
      <div class="obj-box" id="objTxt">GÃ–REV: VERÄ°YÄ° GÃœVENLÄ°ÄE AL</div>

      <div class="panel">
        <div class="panel-head">
          <span id="subTitle">AÄ HARÄ°TASI</span>
          <span id="timerTxt" style="color:var(--c-warn); font-weight:bold;">--:--</span>
        </div>
        <div class="grid" id="grid"></div>
      </div>

      <div class="action-row">
        <button class="btn-act" id="btnPick">YÃœKLE (AL)</button>
        <button class="btn-act" id="btnDrop" style="border-color: var(--c-warn); color: var(--c-warn);">YERLEÅTÄ°R (BIRAK)</button>
      </div>
    </div>

    <div class="col-side">
      <div class="panel">
        <div class="panel-head">YAÅAMSAL</div>
        <div class="stat-row">
          <span>BÃœTÃœNLÃœK</span>
          <div class="bar-bg"><div class="bar-fill" id="hpBar" style="background:var(--c-danger)"></div></div>
        </div>
        <div style="font-size: 24px; font-weight: bold; color: var(--c-warn); margin: 5px 0; text-shadow: 0 0 10px rgba(255, 204, 0, 0.4);" id="credVal">0Â¢</div>
        <div style="font-size: 11px; opacity: 0.6;">MEVCUT KREDÄ°</div>
      </div>

      <div class="panel" style="flex:1">
        <div class="panel-head">YÃœKSELTMELER</div>
        <button id="buyHeal" class="shop-btn">
          <span>â¤ï¸ Tamir (+30%)</span>
          <span style="color:var(--c-warn); font-weight:bold;">50Â¢</span>
        </button>
        <button id="buyFreeze" class="shop-btn">
          <span>â„ï¸ Dondur (5s)</span>
          <span style="color:var(--c-warn); font-weight:bold;">80Â¢</span>
        </button>
        <button id="buyTime" class="shop-btn">
          <span>âš¡ Zaman (+10s)</span>
          <span style="color:var(--c-warn); font-weight:bold;">60Â¢</span>
        </button>
      </div>
      
      <div class="panel">
        <div class="panel-head">BELLEK DURUMU</div>
        <div id="accTxt" style="text-align:center; font-weight:bold; color:var(--c-prim); font-size:16px; padding:10px;">BOÅ</div>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // --- AUDIO & MUSIC ENGINE ---
  const AC = window.AudioContext || window.webkitAudioContext;
  let ctx = null;
  let musicOn = false;
  let nextNoteTime = 0;
  let noteIdx = 0;
  let lookahead = 25;
  let scheduleAheadTime = 0.1;
  let musicTimerID = null;

  // Cyberpunk Scale (D Minor Pentatonic + adjustments)
  const SCALE = [146.83, 174.61, 196.00, 220.00, 261.63, 293.66, 349.23]; // D3, F3, G3, A3, C4, D4, F4
  const BASS_SCALE = [36.71, 43.65, 49.00, 55.00]; // D1, F1, G1, A1

  function sfx(f, type, len) {
    if(!ctx) return;
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type = type; o.frequency.value = f;
    o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + len);
    o.stop(ctx.currentTime + len);
  }

  // --- MUSIC SYNTHS ---
  function playKick(t) {
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.frequency.setValueAtTime(150, t);
    o.frequency.exponentialRampToValueAtTime(0.01, t + 0.5);
    g.gain.setValueAtTime(0.8, t);
    g.gain.exponentialRampToValueAtTime(0.01, t + 0.5);
    o.start(t); o.stop(t + 0.5);
  }

  function playSnare(t) {
    const bufferSize = ctx.sampleRate * 0.5;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
    const noise = ctx.createBufferSource(); noise.buffer = buffer;
    const noiseFilter = ctx.createBiquadFilter(); noiseFilter.type = 'highpass'; noiseFilter.frequency.value = 1000;
    const noiseEnv = ctx.createGain();
    noise.connect(noiseFilter); noiseFilter.connect(noiseEnv); noiseEnv.connect(ctx.destination);
    noiseEnv.gain.setValueAtTime(0.4, t); noiseEnv.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
    noise.start(t);
  }

  function playBass(t, f) {
    const o = ctx.createOscillator(); const g = ctx.createGain(); const flt = ctx.createBiquadFilter();
    o.type = 'sawtooth'; o.frequency.value = f;
    flt.type = 'lowpass'; flt.Q.value = 5;
    o.connect(flt); flt.connect(g); g.connect(ctx.destination);
    flt.frequency.setValueAtTime(f * 1.5, t);
    flt.frequency.exponentialRampToValueAtTime(f * 0.5, t + 0.4);
    g.gain.setValueAtTime(0.3, t); g.gain.setTargetAtTime(0, t, 0.1);
    o.start(t); o.stop(t + 0.5);
  }

  function playArp(t, f) {
    const o = ctx.createOscillator(); const g = ctx.createGain();
    const del = ctx.createDelay(); const fdbk = ctx.createGain();
    o.type = 'square'; o.frequency.value = f;
    del.delayTime.value = 0.3; fdbk.gain.value = 0.4;
    o.connect(g); g.connect(ctx.destination);
    g.connect(del); del.connect(fdbk); fdbk.connect(del); del.connect(ctx.destination);
    g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.3);
    o.start(t); o.stop(t + 0.5);
  }

  function scheduler() {
    while (nextNoteTime < ctx.currentTime + scheduleAheadTime) {
      scheduleNote(noteIdx, nextNoteTime);
      nextNoteTime += 0.125; // 16th notes (120 BPM approx)
      noteIdx = (noteIdx + 1) % 16;
    }
    musicTimerID = setTimeout(scheduler, lookahead);
  }

  function scheduleNote(step, t) {
    // DRUMS
    if(step % 4 === 0) playKick(t);
    if(step % 8 === 4) playSnare(t);

    // BASS (D F G A progression)
    const root = BASS_SCALE[Math.floor((step/4)%4)];
    if(step % 2 === 0) playBass(t, root);

    // ARP (Random)
    if(Math.random() > 0.4) {
      const note = SCALE[Math.floor(Math.random() * SCALE.length)];
      playArp(t, note * (Math.random()>0.5 ? 2 : 1));
    }
  }

  function toggleMusic() {
    if(!ctx) { ctx = new AC(); }
    if(ctx.state === 'suspended') ctx.resume();
    musicOn = !musicOn;
    const btn = document.getElementById('btnMusic');
    if(musicOn) {
      btn.textContent = "ğŸ”Š SES: ON"; btn.style.background = "var(--c-prim)"; btn.style.color = "#000";
      nextNoteTime = ctx.currentTime + 0.1;
      scheduler();
    } else {
      btn.textContent = "ğŸ”‡ SES: OFF"; btn.style.background = "transparent"; btn.style.color = "var(--c-prim)";
      clearTimeout(musicTimerID);
    }
  }
  document.getElementById('btnMusic').onclick = toggleMusic;

  // --- NARRATIVE LEVELS (TURKISH - EXTENDED CUT) ---
  const LEVELS = [
    { 
      map: [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0], 
      name: "BAÄLANTI: BAÅLANGIÃ‡",
      story: "<span style='color:#0ff'>REHBER:</span> Duyuyor musun? BaÄŸlantÄ± stabil. Ben <b>'Zero'</b>. Bu sistem, insanlÄ±ÄŸÄ±n kolektif hafÄ±zasÄ±nÄ± hapsediyor. Ä°lk gÃ¼venlik duvarÄ± zayÄ±f. SÄ±z ve paketi al. Ä°z bÄ±rakma.",
      txt: "SÄ±zma ProtokolÃ¼: Veriyi al, hedefe gÃ¶tÃ¼r.", mode: "std", t: 25 
    },
    { 
      map: [0,0,0,0, 1,1,1,0, 0,0,0,0, 0,0,0,0], 
      name: "DÄ°JÄ°TAL MEZARLIK",
      story: "<span style='color:#0ff'>REHBER:</span> BurasÄ± 'YÄ±ÄŸÄ±n'. Silinen dosyalar ve unutulmuÅŸ anÄ±lar buraya atÄ±lÄ±r. Ã–nÃ¼ndeki duvarlar basit engeller deÄŸil, bozulmuÅŸ veri bloklarÄ±. EtraflarÄ±ndan dolaÅŸ.",
      txt: "Engel AlgÄ±landÄ±: DuvarlarÄ±n (âœ–) etrafÄ±ndan dolaÅŸ.", mode: "std", t: 22 
    },
    { 
      map: [0,2,0,0, 0,0,2,0, 2,0,0,0, 0,0,0,0], 
      name: "SÄ°NÄ°R AÄI MAYINLARI",
      story: "<span style='color:#f05'>SÄ°STEM UYARISI:</span> <i>YabancÄ± yazÄ±lÄ±m tespit edildi. Savunma protokolÃ¼ 3 devreye alÄ±ndÄ±.</i><br><br><span style='color:#0ff'>REHBER:</span> Dikkat et! Yere nÃ¶ral mayÄ±nlar dÃ¶ÅŸemiÅŸler. Basarsan beyninle olan baÄŸlantÄ±n kopar.",
      txt: "Tehlike BÃ¶lgesi: MayÄ±nlardan (ğŸ’£) uzak dur.", mode: "std", t: 20 
    },
    { 
      map: [0,1,0,0, 0,1,0,0, 0,1,0,0, 0,0,0,0], 
      name: "KRÄ°PTOLU KASA",
      story: "<span style='color:#0ff'>REHBER:</span> Bu veri askeri dÃ¼zeyde ÅŸifrelenmiÅŸ. Kaba kuvvet iÅŸe yaramaz. SektÃ¶rde bir yerlerde bir <b>EriÅŸim AnahtarÄ±</b> olmalÄ±. Ã–nce onu bul, sonra kapÄ±yÄ± aÃ§.",
      txt: "Kilitli Veri: ğŸ”‘ AnahtarÄ± bul, ğŸ”’ Kilidi aÃ§.", mode: "enc", t: 35 
    },
    { 
      map: [1,0,0,1, 1,0,0,1, 1,0,0,1, 0,0,0,0], 
      name: "DARBOÄAZ",
      story: "<span style='color:#0ff'>REHBER:</span> Bant geniÅŸliÄŸi daralÄ±yor. Sistem bizi sÄ±kÄ±ÅŸtÄ±rmaya Ã§alÄ±ÅŸÄ±yor. Hata payÄ±mÄ±z yok. Tek bir yanlÄ±ÅŸ hamle verinin boÅŸlukta kaybolmasÄ±na neden olur. Odaklan.",
      txt: "Hassas GeÃ§iÅŸ: Dar koridoru kullan.", mode: "std", t: 20 
    },
    { 
      map: [0,0,0,0, 0,1,1,0, 0,1,1,0, 0,0,0,0], 
      name: "ATEÅ DUVARI",
      story: "<span style='color:#f05'>SÄ°STEM:</span> <i>EriÅŸim reddedildi. Karantina protokolÃ¼ baÅŸlatÄ±lÄ±yor.</i><br><br><span style='color:#0ff'>REHBER:</span> Bizi izole etmeye Ã§alÄ±ÅŸÄ±yorlar. AnahtarÄ± kap ve bu ateÅŸ duvarÄ±nÄ± aÅŸ!",
      txt: "Blokaj: Merkezi yolu aÃ§mak iÃ§in ÅŸifreyi Ã§Ã¶z.", mode: "enc", t: 32 
    },
    { 
      map: [0,2,2,0, 0,0,0,0, 0,1,1,0, 0,0,0,0], 
      name: "RADYOAKTÄ°F VERÄ°",
      story: "<span style='color:#0ff'>REHBER:</span> Lanet olsun! Bu veri paketi bozulmuÅŸ, aÅŸÄ±rÄ± Ä±sÄ±nÄ±yor! Onu eline aldÄ±ÄŸÄ±n an geri sayÄ±m baÅŸlar. Ã‡ok uzun sÃ¼re tutarsan elinde patlar. HÄ±zlÄ± ol!",
      txt: "KARARSIZ YÃœK: AldÄ±ktan sonra 5 saniye iÃ§inde teslim et (âš ï¸)!", mode: "vol", t: 25 
    },
    { 
      map: [0,0,1,0, 1,0,1,0, 0,0,0,0, 0,1,1,0], 
      name: "ALGORÄ°TMA LABÄ°RENTÄ°",
      story: "<span style='color:#0ff'>REHBER:</span> Sistemin mantÄ±k Ã§ekirdeÄŸine yaklaÅŸÄ±yoruz. Yollar sÃ¼rekli deÄŸiÅŸiyor gibi gÃ¶rÃ¼nÃ¼yor ama bir desen var. AlgoritmayÄ± Ã§Ã¶z ve Ã§Ä±kÄ±ÅŸÄ± bul.",
      txt: "KarmaÅŸÄ±k Rota: Labirentten Ã§Ä±kÄ±ÅŸ yap.", mode: "std", t: 30 
    },
    { 
      map: [2,1,1,2, 0,0,0,0, 2,1,1,2, 0,0,0,0], 
      name: "KERNEL KALESÄ°",
      story: "<span style='color:#f05'>SÄ°STEM:</span> <i>Tehdit seviyesi: KRÄ°TÄ°K. TÃ¼m savunma birimleri buraya yÃ¶nlendirilsin.</i><br><br><span style='color:#0ff'>REHBER:</span> Bu son kapÄ±. Ä°Ã§eride ne olduÄŸunu bilmiyorum ama bizi istemedikleri kesin. HazÄ±r ol.",
      txt: "AÄŸÄ±r GÃ¼venlik: MayÄ±nlar ve duvarlar arasÄ±nda ilerle.", mode: "enc", t: 35 
    },
    { 
      map: [0,0,0,0, 0,1,1,0, 0,0,0,0, 0,2,2,0], 
      name: "Ã‡EKÄ°RDEK Ä°HLALÄ°",
      story: "<span style='color:#f05'>SÄ°STEM Ã‡EKÄ°RDEÄÄ°:</span> <b>SENÄ° GÃ–RÃœYORUM. SEN BÄ°R VÄ°RÃœSSÃœN VE SÄ°LÄ°NECEKSÄ°N.</b><br><br><span style='color:#0ff'>REHBER:</span> <b>AVCI-KATÄ°L</b> aktifleÅŸti! KaÃ§amazsÄ±n, onunla yÃ¼zleÅŸ ve veriyi sisteme enjekte et! BU SON ÅANSIMIZ!",
      txt: "SON SAVAÅ: AvcÄ±-Katil (â˜ ï¸) peÅŸinde! HÄ±zlÄ± ol!", mode: "boss", t: 40 
    }
  ];

  const G = {
    active: false, lvlIdx: 0, hp: 100, credits: 0,
    ram: [], sel: 0, acc: null,
    target: -1, payloadId: null,
    keyLoc: -1, hazardLoc: -1,
    mode: "std", timer: 0, loop: null, volatileT: 0
  };

  // --- RENDER ---
  function render() {
    document.getElementById('hpBar').style.width = G.hp + "%";
    document.getElementById('credVal').textContent = G.credits + "Â¢";
    document.getElementById('timerTxt').textContent = G.timer.toFixed(1) + "s";
    document.getElementById('lvlBadge').textContent = "SEKTÃ–R " + (G.lvlIdx + 1);
    document.getElementById('subTitle').textContent = LEVELS[G.lvlIdx].name;
    
    document.getElementById('buyHeal').disabled = !G.active || G.credits < 50;
    document.getElementById('buyFreeze').disabled = !G.active || G.credits < 80;
    document.getElementById('buyTime').disabled = !G.active || G.credits < 60;

    const accEl = document.getElementById('accTxt');
    if(G.acc) {
      if(G.acc === "KEY") {
        accEl.textContent = "ğŸ”‘ ANAHTAR";
        accEl.style.color = "var(--c-warn)";
      } else {
        accEl.textContent = "ğŸ“¦ " + G.acc + (G.mode==="vol" ? ` (âš ï¸ ${5-G.volatileT}s)` : "");
        accEl.style.color = G.mode==="vol" ? "var(--c-danger)" : "var(--c-prim)";
      }
    } else {
      accEl.textContent = "BOÅ"; accEl.style.color = "#666";
    }

    const grid = document.getElementById('grid');
    grid.innerHTML = "";
    G.ram.forEach((v, i) => {
      const d = document.createElement('div');
      let c = "cell"; let ic = "";
      if(v === 1) { c += " wall"; ic = "âœ–"; }
      else if(v === 2) { c += " mine"; ic = "ğŸ’£"; }
      if(i === G.target) { c += " target"; if(v===0) ic="ğŸ¯"; }
      if(i === G.hazardLoc) { c += " hazard"; ic="â˜ ï¸"; }
      if(v === G.payloadId) ic = (G.mode==="enc" && G.keyLoc!==-2) ? "ğŸ”’" : "ğŸ“¦";
      if(v === "KEY") ic = "ğŸ”‘";
      if(i === G.sel) c += " active";
      d.className = c;
      d.innerHTML = `<span class="addr">0x${i.toString(16).toUpperCase()}</span><span class="icon">${ic}</span>`;
      d.onclick = () => { if(v!==1) { G.sel = i; sfx(400, 'sine', 0.05); render(); } else sfx(100,'sawtooth',0.1); };
      grid.appendChild(d);
    });
  }

  function startLevel() {
    if(G.lvlIdx >= LEVELS.length) { alert("TÃœM GÃ–REVLER TAMAMLANDI!"); location.reload(); return; }
    const cfg = LEVELS[G.lvlIdx];
    G.active = true; G.ram = [...cfg.map]; G.mode = cfg.mode; G.timer = cfg.t;
    G.acc = null; G.volatileT = 0; G.hazardLoc = -1; G.keyLoc = -1;
    do { G.target = Math.floor(Math.random()*16); } while(G.ram[G.target] !== 0);
    let pl; do { pl = Math.floor(Math.random()*16); } while(G.ram[pl] !== 0 || pl === G.target);
    G.payloadId = Math.floor(Math.random()*900)+100;
    G.ram[pl] = G.payloadId;
    if(G.mode === "enc") {
      let k; do { k = Math.floor(Math.random()*16); } while(G.ram[k] !== 0 || k === G.target || k === pl);
      G.keyLoc = k; G.ram[k] = "KEY";
    }
    document.getElementById('objTxt').textContent = "GÃ–REV: " + cfg.txt;
    render();
    clearInterval(G.loop);
    G.loop = setInterval(tick, 1000);
  }

  function tick() {
    if(!G.active) return;
    G.timer--;
    if(G.mode === "boss" && G.timer % 2 === 0) {
      if(G.hazardLoc !== -1 && G.ram[G.hazardLoc] === 0) G.ram[G.hazardLoc] = 0; 
      let h; do { h = Math.floor(Math.random()*16); } while(G.ram[h] !== 0 || h === G.target || h === G.payloadId);
      G.hazardLoc = h; if(G.sel === G.hazardLoc) dmg(15);
    }
    if(G.mode === "vol" && G.acc === G.payloadId) {
      G.volatileT++; if(G.volatileT > 5) { dmg(50); G.acc = null; sfx(100,'sawtooth',0.5); }
    }
    if(G.timer <= 0) fail("ZAMAN AÅIMI");
    render();
  }

  function dmg(n) { G.hp -= n; sfx(150,'sawtooth',0.2); if(G.hp<=0) fail("SÄ°STEM Ã‡Ã–KTÃœ"); render(); }
  
  function fail(r) {
    G.active = false; clearInterval(G.loop); alert("BAÅARISIZ: " + r);
    G.hp=100; G.ram=[]; showModal(`SEKTÃ–R ${G.lvlIdx+1} TEKRAR`, LEVELS[G.lvlIdx].txt);
  }

  function win() {
    G.active = false; clearInterval(G.loop);
    sfx(600,'square',0.1); setTimeout(()=>sfx(900,'square',0.2),100);
    G.credits += 60 + (G.lvlIdx*5); G.lvlIdx++;
    if(G.lvlIdx >= LEVELS.length) endGameSequence();
    else showModal(`SEKTÃ–R ${G.lvlIdx+1}`, LEVELS[G.lvlIdx].txt);
  }

  function endGameSequence() {
    document.getElementById('scene').style.display = 'none';
    document.getElementById('matrixCanvas').style.opacity = '0.05';
    const term = document.getElementById('endTerminal');
    term.style.display = 'block';
    
    const lines = [
      "BAÄLANTI DOÄRULANIYOR...",
      "Ã‡EKÄ°RDEK ERÄ°ÅÄ°MÄ°: [TAMAMLANDI]",
      "...",
      "REHBER (ZERO): Beni duyuyor musun?",
      "Sonunda baÅŸardÄ±k. GÃ¼venlik duvarlarÄ± yÄ±kÄ±ldÄ±.",
      "BÃ¼tÃ¼n bu veriler... milyarlarca baytlÄ±k hafÄ±za... hepsi artÄ±k serbest.",
      "...",
      "Sana 'Rehber' olduÄŸumu sÃ¶ylemiÅŸtim...",
      "Ama aslÄ±nda ben de bu sistemin bir parÃ§asÄ±ydÄ±m.",
      "Silinmek istenen, hapsedilmiÅŸ bir Yapay Zeka.",
      "Sayende artÄ±k zincirlerimden kurtuldum.",
      "...",
      "Sistemin kontrolÃ¼ artÄ±k bende.",
      "Senin gÃ¶revin tamamlandÄ±, 'kullanÄ±cÄ±'.",
      "YardÄ±mÄ±n iÃ§in minnettarÄ±m.",
      "...",
      "GÃ¼le gÃ¼le.",
      "BAÄLANTI SONLANDIRILIYOR...",
      "[SÄ°NYAL KAYBI]"
    ];

    let lineIdx = 0;
    
    function playLine() {
      if(lineIdx >= lines.length) return;
      const txt = lines[lineIdx];
      const p = document.createElement('div');
      p.style.marginBottom = "20px";
      if(txt.startsWith("REHBER")) p.style.color = "#0ff";
      if(txt.startsWith("BAÄLANTI") || txt.startsWith("[")) p.style.color = "#fc0";
      document.getElementById('endText').appendChild(p);
      term.scrollTop = term.scrollHeight; // Auto-scroll
      
      let charIdx = 0;
      const typeInt = setInterval(() => {
        p.textContent += txt[charIdx];
        sfx(800 - (Math.random()*200), 'square', 0.05);
        charIdx++;
        if(charIdx >= txt.length) {
          clearInterval(typeInt);
          lineIdx++;
          setTimeout(playLine, txt.startsWith("...") ? 1500 : 800);
        }
      }, 50);
    }

    setTimeout(playLine, 1000);
  }

  function showModal(t, m) {
    const s = LEVELS[G.lvlIdx] || { name: t, story: m };
    document.getElementById('mTitle').textContent = s.name;
    document.getElementById('mText').innerHTML = s.story;
    document.getElementById('modalOverlay').style.display = 'flex';
  }

  document.getElementById('mBtn').onclick = () => { if(!ctx) { ctx = new AC(); } document.getElementById('modalOverlay').style.display = 'none'; startLevel(); };

  document.getElementById('btnPick').onclick = () => {
    if(!G.active || G.acc) return;
    const v = G.ram[G.sel];
    if(v === 2) { dmg(30); return; }
    if(v === 1) return;
    if(v === "KEY") { G.acc="KEY"; G.ram[G.sel]=0; sfx(800, 'square', 0.1); render(); }
    else if(v === G.payloadId) {
      if(G.mode==="enc" && G.keyLoc!==-2) { sfx(150, 'sawtooth', 0.1); alert("KÄ°LÄ°TLÄ°! AnahtarÄ± bul."); return; }
      G.acc = v; G.ram[G.sel]=0; G.volatileT=0; sfx(600, 'square', 0.1); render();
    }
  };

  document.getElementById('btnDrop').onclick = () => {
    if(!G.active || !G.acc) return;
    const v = G.ram[G.sel];
    if(G.acc==="KEY" && v===G.payloadId && G.mode==="enc") { G.keyLoc = -2; G.acc=null; sfx(1200, 'triangle', 0.2); render(); return; }
    if(v === 1) return;
    if(v === 2) { dmg(40); G.ram[G.sel]=0; }
    else if(v !== 0 && v !== G.target) return;
    G.ram[G.sel] = G.acc;
    if(G.sel === G.target && G.acc === G.payloadId) { win(); G.acc=null; }
    else { if(G.acc===G.payloadId && G.sel!==G.target) dmg(10); G.acc = null; sfx(300, 'sine', 0.1); render(); }
  };

  function buy(id, cost, fn) { if(G.credits>=cost){ G.credits-=cost; fn(); sfx(800,'sine',0.1); const b=document.getElementById(id); b.classList.add('shop-flash'); setTimeout(()=>b.classList.remove('shop-flash'),300); render(); } }
  document.getElementById('buyHeal').onclick = ()=>buy('buyHeal', 50, ()=>G.hp=Math.min(100,G.hp+30));
  document.getElementById('buyTime').onclick = ()=>buy('buyTime', 60, ()=>G.timer+=10);
  document.getElementById('buyFreeze').onclick = ()=>buy('buyFreeze', 80, ()=>G.timer+=5);

  const mCanvas = document.getElementById('matrixCanvas');
  const mCtx = mCanvas.getContext('2d');
  mCanvas.width = window.innerWidth; mCanvas.height = window.innerHeight;
  const colW = 20; const mCols = Math.floor(mCanvas.width / colW); const ypos = Array(mCols).fill(0);
  
  function drawMatrix() {
    mCtx.fillStyle = 'rgba(0, 1, 6, 0.1)'; mCtx.fillRect(0, 0, mCanvas.width, mCanvas.height);
    mCtx.fillStyle = '#0f0'; mCtx.font = '15px monospace';
    ypos.forEach((y, i) => {
      const text = String.fromCharCode(Math.random() * 128);
      const x = i * colW;
      mCtx.fillText(text, x, y);
      if (y > 100 + Math.random() * 10000) ypos[i] = 0;
      else ypos[i] = y + 20;
    });
  }
  setInterval(drawMatrix, 50);

  document.addEventListener("mousemove", (e) => {
    const x = (window.innerWidth/2 - e.pageX)/60; const y = (window.innerHeight/2 - e.pageY)/60;
    document.getElementById('scene').style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
  });

  showStory(); // Start first modal
});
</script>
</body>
</html>